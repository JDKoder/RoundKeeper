<project xmlns:ivy="antlib:org.apache.ivy.ant" name="RoundKeeper" default="build">

   <target name="resolve" description="--> retrieve dependencies with ivy" unless="resolve.init">
        <path id="ivy.lib.path">
			<fileset dir="${basedir}/lib" includes="*.jar"/>
		</path>
		
		<ivy:settings id="basic.settings" file="${basedir}/settings/ivysettings.xml"/>
		<ivy:retrieve settingsRef="basic.settings"/>
		<ivy:resolve />
		<property name="resolve.init" value="true"/>
   </target>	
	
  <target name="init">
	<property name="sourceDir" value="src" />
  	<property name="testDir" value="test" />
	<property name="targetDir" value="target" />
  	<property name="reportDir" value="${targetDir}/reports" />
	<property name="outputDir" value="${targetDir}/classes" />
  	<property name="outputTestDir" value="${targetDir}/${testDir}" />
	<property name="lib.dir" value="lib" />
	<property name="jarName" value="RoundKeeper.jar" />
  </target>
  
  <target name="clean" depends="init">
	<delete dir="${targetDir}" />
  </target>
  
  <target name="prep" depends="clean, resolve">
	<mkdir dir="${reportDir}" />
  	<mkdir dir="${outputDir}" />
  	<mkdir dir="${outputTestDir}" />
  </target>
  
  <target name="compile" depends="prep">
	<javac srcdir="${sourceDir}" destdir="${outputDir}" includeantruntime="false">
		<include name="**/*.java"/>
		<classpath>
			<path refid="ivy.lib.path" />
		</classpath>
	</javac>
	
	<jar basedir="${outputDir}" destfile="${targetDir}/${jarName}"/>
	<path id="target.compiled">
		<fileset dir="${targetDir}" includes="*.jar"/>
	</path>
  </target>
	
  <target name="compiletests" depends="resolve, compile">
  	<javac srcdir="${testDir}" destdir="${outputTestDir}" includeantruntime="false">
		<include name="**/*.java"/>
		<classpath>
			<path refid="ivy.lib.path" />
			<path refid="target.compiled"/>
		</classpath>
	</javac>
  </target>
  
  <target name="test" depends="compiletests">
  		<junit haltonerror="true" haltonfailure="true">
  			<batchtest haltonfailure="true" todir="${reportDir}">
  				<fileset dir="${outputTestDir}" includes="**/*.java" />
  			</batchtest>
  		</junit>
  </target>
  
  <target name="build" depends="test">
        <jar destfile="E:/PROJECTS/myprojects/RoundKeeper/target/RoundKeeper.jar">
            <manifest>
                <attribute name="Main-Class" value="org.eclipse.jdt.internal.jarinjarloader.JarRsrcLoader"/>
                <attribute name="Rsrc-Main-Class" value="com.warriorwebpros.Main"/>
                <attribute name="Class-Path" value="."/>
                <attribute name="Rsrc-Class-Path" value="./ org.eclipse.swt.win32.win32.x86_64-3.6.2.jar junit-4.8.1.jar mockito-all-1.9.0.jar junit-4.8.1.jar hamcrest-all-1.3.jar mockito-all-1.9.0.jar org.eclipse.swt.win32.win32.x86_64-3.7.2.jar org.eclipse.swt.win32.win32.x86-3.7.2.jar org.eclipse.swt.cocoa.macosx-3.7.2.jar org.eclipse.swt.cocoa.macosx.x86_64-3.7.2.jar"/>
            </manifest>
            <zipfileset src="jar-in-jar-loader.zip"/>
            <fileset dir="E:/PROJECTS/myprojects/RoundKeeper/bin"/>
            <zipfileset dir="E:\PROJECTS\myprojects\RoundKeeper\lib" includes="org.eclipse.swt.win32.win32.x86_64-3.6.2.jar"/>
            <zipfileset dir="E:\PROJECTS\myprojects\RoundKeeper\lib" includes="junit-4.8.1.jar"/>
            <zipfileset dir="E:\PROJECTS\myprojects\RoundKeeper\lib" includes="mockito-all-1.9.0.jar"/>
            <zipfileset dir="C:\Users\KriegerJ\.ivy2\cache\junit\junit\jars" includes="junit-4.8.1.jar"/>
            <zipfileset dir="C:\Users\KriegerJ\.ivy2\cache\org.hamcrest\hamcrest-all\jars" includes="hamcrest-all-1.3.jar"/>
            <zipfileset dir="C:\Users\KriegerJ\.ivy2\cache\org.mockito\mockito-all\jars" includes="mockito-all-1.9.0.jar"/>
            <zipfileset dir="C:\Users\KriegerJ\.ivy2\cache\org.eclipse.swt\org.eclipse.swt.win32.win32.x86_64\jars" includes="org.eclipse.swt.win32.win32.x86_64-3.7.2.jar"/>
            <zipfileset dir="C:\Users\KriegerJ\.ivy2\cache\org.eclipse.swt\org.eclipse.swt.win32.win32.x86\jars" includes="org.eclipse.swt.win32.win32.x86-3.7.2.jar"/>
            <zipfileset dir="C:\Users\KriegerJ\.ivy2\cache\org.eclipse.swt\org.eclipse.swt.cocoa.macosx\jars" includes="org.eclipse.swt.cocoa.macosx-3.7.2.jar"/>
            <zipfileset dir="C:\Users\KriegerJ\.ivy2\cache\org.eclipse.swt\org.eclipse.swt.cocoa.macosx.x86_64\jars" includes="org.eclipse.swt.cocoa.macosx.x86_64-3.7.2.jar"/>
        </jar>
    </target>
  
</project>